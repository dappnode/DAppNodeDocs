<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../images/favicon.ico"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Architecture - Documentation</title><link rel="stylesheet" href="../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#009688"><script src="../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../assets/fonts/material-icons.css"><link rel="stylesheet" href="../stylesheets/extras.css"></head><body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#architecture" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href=".." title="Documentation" class="md-header-nav__button md-logo"><img src="../images/logo_with_name.png" width="24" height="24"></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Documentation</span><span class="md-header-nav__topic">Architecture</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href=".." title="Documentation" class="md-nav__button md-logo"><img src="../images/logo_with_name.png" width="48" height="48"></a>Documentation</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href=".." title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item"><a href="../versions/" title="Versions covered" class="md-nav__link">Versions covered</a></li><li class="md-nav__item"><a href="../introduction/" title="Introduction" class="md-nav__link">Introduction</a></li><li class="md-nav__item"><a href="../install/" title="Install" class="md-nav__link">Install</a></li><li class="md-nav__item"><a href="../connect/" title="Connect to DAppNode" class="md-nav__link">Connect to DAppNode</a></li><li class="md-nav__item"><a href="../what-can-you-do/" title="What can you do with DAppNode?" class="md-nav__link">What can you do with DAppNode?</a></li><li class="md-nav__item"><a href="../user-guide/" title="User Guide" class="md-nav__link">User Guide</a></li><li class="md-nav__item"><a href="../faqs/" title="FAQs" class="md-nav__link">FAQs</a></li><li class="md-nav__item"><a href="../troubleshooting/" title="Troubleshooting" class="md-nav__link">Troubleshooting</a></li><li class="md-nav__item"><a href="../Migration to v0.2.0/" title="Migration to v0.2.0" class="md-nav__link">Migration to v0.2.0</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Architecture</label><a href="./" title="Architecture" class="md-nav__link md-nav__link--active">Architecture</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#bind" title="BIND" class="md-nav__link">BIND</a></li><li class="md-nav__item"><a href="#vpn" title="VPN" class="md-nav__link">VPN</a></li><li class="md-nav__item"><a href="#ethchain" title="ETHCHAIN" class="md-nav__link">ETHCHAIN</a></li><li class="md-nav__item"><a href="#ethforward" title="ETHFORWARD" class="md-nav__link">ETHFORWARD</a></li><li class="md-nav__item"><a href="#ipfs" title="IPFS" class="md-nav__link">IPFS</a></li><li class="md-nav__item"><a href="#wamp" title="WAMP" class="md-nav__link">WAMP</a></li><li class="md-nav__item"><a href="#dappmanager" title="DAPPMANAGER" class="md-nav__link">DAPPMANAGER</a></li><li class="md-nav__item"><a href="#admin" title="ADMIN" class="md-nav__link">ADMIN</a></li></ul></nav></li><li class="md-nav__item"><a href="../manifest-reference/" title="DAppNode Package Manifest Reference" class="md-nav__link">DAppNode Package Manifest Reference</a></li><li class="md-nav__item"><a href="../setup-wizard-reference/" title="DAppNode Package Setup Wizard Reference" class="md-nav__link">DAppNode Package Setup Wizard Reference</a></li><li class="md-nav__item"><a href="../contributing/" title="Contributing" class="md-nav__link">Contributing</a></li><li class="md-nav__item"><a href="../license/" title="License" class="md-nav__link">License</a></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#bind" title="BIND" class="md-nav__link">BIND</a></li><li class="md-nav__item"><a href="#vpn" title="VPN" class="md-nav__link">VPN</a></li><li class="md-nav__item"><a href="#ethchain" title="ETHCHAIN" class="md-nav__link">ETHCHAIN</a></li><li class="md-nav__item"><a href="#ethforward" title="ETHFORWARD" class="md-nav__link">ETHFORWARD</a></li><li class="md-nav__item"><a href="#ipfs" title="IPFS" class="md-nav__link">IPFS</a></li><li class="md-nav__item"><a href="#wamp" title="WAMP" class="md-nav__link">WAMP</a></li><li class="md-nav__item"><a href="#dappmanager" title="DAPPMANAGER" class="md-nav__link">DAPPMANAGER</a></li><li class="md-nav__item"><a href="#admin" title="ADMIN" class="md-nav__link">ADMIN</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="architecture">Architecture</h1>
<p>DAppNode is a collection of interdependent docker containerized packages (referred here as core DNPs). DAppNode's core DNPs are:</p>
<ul>
<li>DNP_BIND</li>
<li>DNP_VPN</li>
<li>DNP_ETHCHAIN</li>
<li>DNP_ETHFORWARD</li>
<li>DNP_IPFS</li>
<li>DNP_WAMP</li>
<li>DNP_ADMIN</li>
<li>DNP_DAPPMANAGER</li>
</ul>
<h2 id="bind">BIND</h2>
<p>Local DAppNode DNS. Links each package docker IP to a name in the format of my.[package-name].dnp.dappnode.eth. It also redirects .eth domains to the Ethforward. All rules can be consulted at <code>eth.hosts &lt;https://github.com/dappnode/DNP_BIND/raw/master/build/bind/eth.hosts&gt;</code>_.</p>
<p>It runs the native Linux bind package with a configuration specified at <code>named.conf &lt;https://github.com/dappnode/DNP_BIND/raw/master/build/bind/named.conf&gt;</code>_. It attempts resolution and otherwise forwards to the Google Public DNS 8.8.8.8 / 8.8.4.4.</p>
<h2 id="vpn">VPN</h2>
<p>Provides a basic VPN for users to consume DAppNode's services.</p>
<p>It runs a <code>xl2tpd &lt;https://github.com/xelerance/xl2tpd&gt;</code><em> process alongside a NodeJS app, both controlled by a supervisord process. The NodeJS app connects with the WAMP to manage VPN users directly editing the <code>/etc/ppp/chap-secrets &lt;http://l4u-00.jinr.ru/usoft/WWW/HOWTO/PPP-HOWTO-13.html&gt;</code></em> file, which holds the users' credentials.</p>
<p>The user IP is static and set when that user is created. The static IP is used by the WAMP for authentication to allow only admin users to perform certain actions. Currently, there are three types of users:</p>
<ul>
<li>172.33.10.1: Super admin. It is created when DAppNode is installed and can never be deleted</li>
<li>172.33.10.x: Admin user.</li>
<li>172.33.100.x: Non-admin user.</li>
</ul>
<h2 id="ethchain">ETHCHAIN</h2>
<p>Local full mainnet Ethereum node. Right now it uses parity, but we are testing Geth against Parity to take a decision based on each client's efficiency, memory usage, time to use among other parameters.</p>
<h2 id="ethforward">ETHFORWARD</h2>
<p>Resolves .eth domains by intercepting outgoing requests, calling ENS, and redirecting to the local IPFS node.</p>
<p>It is a NodeJS HTTP proxy server, which also returns custom 404 pages if the content is not found or available or if the chain is still not synced.</p>
<h2 id="ipfs">IPFS</h2>
<p>Local IFPS node. Its gateway is available at:</p>
<div class="codehilite"><pre><span></span><code><span class="nx">host</span><span class="o">:</span> <span class="nx">my</span><span class="p">.</span><span class="nx">ipfs</span><span class="p">.</span><span class="nx">dnp</span><span class="p">.</span><span class="nx">dappnode</span><span class="p">.</span><span class="nx">eth</span><span class="p">;</span>
<span class="nx">port</span><span class="o">:</span> <span class="mi">5001</span><span class="p">;</span>
<span class="nx">protocol</span><span class="o">:</span> <span class="nx">http</span><span class="p">;</span>
</code></pre></div>

<h2 id="wamp">WAMP</h2>
<p>Handles inter-package communications. Restricts certain operations to only admin users.</p>
<p>We are using <code>crossbar.io &lt;https://crossbar.io&gt;</code><em> and its javascript client <code>autobahn.js &lt;https://github.com/crossbario/autobahn-js&gt;</code></em>. Please refer to their documentation for more details.</p>
<h2 id="dappmanager">DAPPMANAGER</h2>
<p>Installs and manages DAppNode packages (DNPs). It's a Nodejs app whose procedures are only consumed by the ADMIN and depends on IPFS and ETHCHAIN to function.</p>
<h2 id="admin">ADMIN</h2>
<p>Handles admin users &lt;-&gt; DAppNode interactions, such as managing packages or VPN users. It is an NGINX process that serves a single-page React app that consumes RPCs of the DAPPMANAGER and the VPN.</p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../Migration to v0.2.0/" title="Migration to v0.2.0" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Migration to v0.2.0</span></div></a><a href="../manifest-reference/" title="DAppNode Package Manifest Reference" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>DAppNode Package Manifest Reference</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div><div class="md-footer-social"><link rel="stylesheet" href="../assets/fonts/font-awesome.css"> <a href="https://github.com/dappnode/DAppNode" class="md-footer-social__link fa fa-github"></a>  <a href="https://twitter.com/dappnode" class="md-footer-social__link fa fa-twitter"></a>  <a href="https://discourse.dappnode.io/" class="md-footer-social__link fa fa-comments"></a>  <a href="https://medium.com/dappnode" class="md-footer-social__link fa fa-medium"></a> </div></div></div></footer></div><script src="../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:".."}})</script></body></html>